<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>GPS</title>

		<script type="text/javascript" src="sodegaura_coords_01.js"></script>
		<script type="text/javascript" src="sodegaura_coords_02.js"></script>

		<script>
			window.BoundingRectangle = (function defineBoundingRectangle() {
				function boundingRectangle(northWest, southEast) {
					var origin = northWest,
						opposite = southEast,
						translation = {x: 0, y: 0},
						scaling = 1;

					function BoundingRectangle() {
						return this;
					};

					function width() {
						return opposite.x - origin.x;
					};

					function height() {
						return opposite.y - origin.y;
					};

					BoundingRectangle.prototype.moveTo = function(newOrigin) {
						translation = {x: (origin.x - newOrigin.x), y: (origin.y - newOrigin.y)};

						opposite = {x: opposite.x - translation.x, y: opposite.y - translation.y};
						origin = newOrigin;
					};

					BoundingRectangle.prototype.scale = function(scale) {
						scaling = scale;
						opposite = {x: opposite.x * scaling, y: opposite.y * scaling};
					};

					BoundingRectangle.prototype.drawOn = function(context, strokeColor) {
						context.strokeStyle = "red";
						context.strokeRect(origin.x, origin.y, width(), height());
					};

					BoundingRectangle.prototype.computerBestScale = function(containerArea) {
						var xScale = containerArea.width / width(),
							yScale = containerArea.height / height();

						return Math.min(xScale, yScale);
					};

					BoundingRectangle.prototype.normalize = function(point) {
						var translatedPoint = {x: point.x - translation.x, y: point.y - translation.y};
						var scaledPoint = {x: translatedPoint.x * scaling, y: translatedPoint.y * scaling};
						return scaledPoint;
					};

					return new BoundingRectangle();
				};

				return {
					from: function(cloud) {
						var minX, minY, maxX, maxY;

						minX = Math.min.apply(null, cloud.map(function(point) {
							return point.x;
						}));

						minY = Math.min.apply(null, cloud.map(function(point) {
							return point.y;
						}));

						maxX = Math.max.apply(null, cloud.map(function(point) {
							return point.x;
						}));

						maxY = Math.max.apply(null, cloud.map(function(point) {
							return point.y;
						}));

						return boundingRectangle({x: minX, y: minY}, {x: maxX, y: maxY});
					}
				};
			})();

			window.onload = function() {
				var outside = window.sodegaura_01_coords;
				var inside = window.sodegaura_02_coords;

				var boundingRectangle = BoundingRectangle.from(outside);

				var canvas = document.getElementById('grid');
				var ctx = canvas.getContext('2d');

				boundingRectangle.moveTo({x: 0, y: 0});
				var scale = boundingRectangle.computerBestScale({width: 1000, height: 700});
				boundingRectangle.scale(scale);
				boundingRectangle.drawOn(ctx, 'blue');

				var firstOut = boundingRectangle.normalize(outside.shift());
				ctx.beginPath();
				ctx.moveTo(firstOut.x, firstOut.y);

				outside.forEach(function(point) {
					var normalizedPoint = boundingRectangle.normalize(point);
					ctx.lineTo(normalizedPoint.x, normalizedPoint.y);
				});
				ctx.strokeStyle = 'red';
				ctx.stroke();

				var firstIn = boundingRectangle.normalize(inside.shift());
				ctx.beginPath();
				ctx.moveTo(firstIn.x, firstIn.y);

				inside.forEach(function(point) {
					var normalizedPoint = boundingRectangle.normalize(point);
					ctx.lineTo(normalizedPoint.x, normalizedPoint.y);
				});
				ctx.strokeStyle = 'green';
				ctx.stroke();
			};
		</script>
	</head>
	<body>
			<canvas id="grid" width="1000" height="700" style="border-style:solid; border-width:1px;"></canvas>
	</body>
</html>