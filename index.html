<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>GPS</title>

		<script type="text/javascript" src="sodegaura_coords_01.js"></script>
		<script type="text/javascript" src="sodegaura_coords_02.js"></script>

		<script>
			window.onload = function() {
				var gpsCoordinates = window.sodegaura_01_coords;

				var minLatitude = Math.min.apply(null, gpsCoordinates.map(function(coordinate) {
					return coordinate.latitude;
				}));

				var minLongitude = Math.min.apply(null, gpsCoordinates.map(function(coordinate) {
					return coordinate.longitude;
				}));

				var maxLatitude = Math.max.apply(null, gpsCoordinates.map(function(coordinate) {
					return coordinate.latitude;
				}));

				var maxLongitude = Math.max.apply(null, gpsCoordinates.map(function(coordinate) {
					return coordinate.longitude;
				}));

				var origin = {latitude: minLatitude, longitude: minLongitude};
				var opposite = {latitude: maxLatitude, longitude: maxLongitude};
				console.log(origin);
				console.log(opposite);

				function toRadian(angleInDegrees) {
					return angleInDegrees * Math.PI / 180;
				}

				var relativeGpsCoordinates = gpsCoordinates.map(function(coordinate) {
					return {latitude: coordinate.latitude - origin.latitude, longitude: coordinate.longitude - origin.longitude};
				});

				var earthRadius = 6378137.0;
				var cartesianCoordinates = relativeGpsCoordinates.map(function(coordinate) {
					return {x: Math.tan(toRadian(coordinate.latitude) / 2), y: Math.tan(toRadian(coordinate.longitude) / 2)};
				});

				console.log(cartesianCoordinates);


				var maxX = Math.max.apply(null, cartesianCoordinates.map(function(coordinate) {
					return coordinate.x;
				}));

				var maxY = Math.max.apply(null, cartesianCoordinates.map(function(coordinate) {
					return coordinate.y;
				}));

				var topRight = {x: maxX, y: maxY};

				console.log(topRight);

				var canvas = document.getElementById('grid');
				var ctx = canvas.getContext('2d');

				var translatedCoordinates = gpsCoordinates.map(function(coordinate) {
					return {latitude: coordinate.latitude - origin.latitude, longitude: coordinate.longitude - origin.longitude};
				});

				var maxLatitudeTranslated = Math.max.apply(null, translatedCoordinates.map(function(coordinate) {
					return coordinate.latitude;
				}));

				var maxLongitudeTranslated = Math.max.apply(null, translatedCoordinates.map(function(coordinate) {
					return coordinate.longitude;
				}));

				var translatedOpposite = {latitude: maxLatitudeTranslated, longitude: maxLongitudeTranslated};

				var scaledCoordinates = translatedCoordinates.map(function(coordinate) {
					console.log(coordinate);
					var scaledCoordinate =
					{latitude: coordinate.latitude * 500 / translatedOpposite.latitude, longitude: coordinate.longitude * 250 / translatedOpposite.longitude};
					console.log(scaledCoordinate);
					return scaledCoordinate;
				});

				var first = scaledCoordinates.shift();
				ctx.beginPath();
				ctx.moveTo(first.latitude, first.longitude);

				scaledCoordinates.forEach(function(coordinate) {
					ctx.lineTo(coordinate.latitude, coordinate.longitude);
				});

				ctx.lineWidth = 1;
				ctx.strokeStyle = 'red';
				ctx.stroke();
			};
		</script>
	</head>
	<body>
			<canvas id="grid" width="500" height="250" style="border-style:solid; border-width:1px;"></canvas>
	</body>
</html>