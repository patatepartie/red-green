<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbmHfS_lnio4OUmcX8KTE-hi4Tk4exSeo&sensor=false">
    </script>

    <script type="text/javascript" src="sodegaura_gmaps_01.js"></script>
    <script type="text/javascript" src="sodegaura_gmaps_02.js"></script>

    <script type="text/javascript">
      window.BoundingRectangle = (function defineBoundingRectangle() {
        function boundingRectangle(northWest, southEast) {
          var origin = northWest,
            opposite = southEast,
            translation = {x: 0, y: 0},
            scaling = 1;

          function BoundingRectangle() {
            return this;
          };

          function width() {
            return opposite.x - origin.x;
          };

          function height() {
            return opposite.y - origin.y;
          };

          BoundingRectangle.prototype.moveTo = function(newOrigin) {
            translation = {x: (origin.x - newOrigin.x), y: (origin.y - newOrigin.y)};

            opposite = {x: opposite.x - translation.x, y: opposite.y - translation.y};
            origin = newOrigin;
          };

          BoundingRectangle.prototype.scale = function(scale) {
            scaling = scale;
            opposite = {x: opposite.x * scaling, y: opposite.y * scaling};
          };

          BoundingRectangle.prototype.drawOn = function(context, strokeColor) {
            context.strokeStyle = "red";
            context.strokeRect(origin.x, origin.y, width(), height());
          };

          BoundingRectangle.prototype.computerBestScale = function(containerArea) {
            var xScale = containerArea.width / width(),
              yScale = containerArea.height / height();

            return Math.min(xScale, yScale);
          };

          BoundingRectangle.prototype.normalize = function(point) {
            var translatedPoint = {x: point.x - translation.x, y: point.y - translation.y};
            var scaledPoint = {x: translatedPoint.x * scaling, y: translatedPoint.y * scaling};
            return scaledPoint;
          };

          return new BoundingRectangle();
        };

        return {
          from: function(cloud) {
            var minX, minY, maxX, maxY;

            minX = Math.min.apply(null, cloud.map(function(point) {
              return point.x;
            }));

            minY = Math.min.apply(null, cloud.map(function(point) {
              return point.y;
            }));

            maxX = Math.max.apply(null, cloud.map(function(point) {
              return point.x;
            }));

            maxY = Math.max.apply(null, cloud.map(function(point) {
              return point.y;
            }));

            return boundingRectangle({x: minX, y: minY}, {x: maxX, y: maxY});
          }
        };
      })();

      function addPath(map, coords, color) {
        var path = new google.maps.Polyline({
          path: coords,
          strokeColor: color,
          strokeOpacity: 1.0,
          strokeWeight: 2
        });

        path.setMap(map);
      }

      function findBoundingRectangle(cloud) {
        var minX, minY, maxX, maxY;

        minX = Math.min.apply(null, cloud.map(function(point) {
          return point.lat();
        }));

        minY = Math.min.apply(null, cloud.map(function(point) {
          return point.lng();
        }));

        maxX = Math.max.apply(null, cloud.map(function(point) {
          return point.lat();
        }));

        maxY = Math.max.apply(null, cloud.map(function(point) {
          return point.lng();
        }));

        var result = [
          new google.maps.LatLng(minX, minY),
          new google.maps.LatLng(minX, maxY),
          new google.maps.LatLng(maxX, maxY),
          new google.maps.LatLng(maxX, minY),
          new google.maps.LatLng(minX, minY)
        ];

        return result;
      };

      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(35.393795,140.089604),
          zoom: 17,
          mapTypeId: google.maps.MapTypeId.SATELLITE
        };
        window.map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);

        var startLine = [
          new google.maps.LatLng(35.395000, 140.087851),
          new google.maps.LatLng(35.394827, 140.088220)
        ];

        addPath(map, findBoundingRectangle(window.sodegaura_01_coords), "#0000FF");
        addPath(map, window.sodegaura_01_coords, "#FF0000");
        addPath(map, window.sodegaura_02_coords, "#FF0000");
        addPath(map, startLine, "#0000FF");

        map.addListener('projection_changed', function() {
          var proj = window.map.getProjection();
          var insideCoords = window.sodegaura_01_coords.map(function(coord) {
            return proj.fromLatLngToPoint(coord);
          });

          var outsideCoords = window.sodegaura_02_coords.map(function(coord) {
            return proj.fromLatLngToPoint(coord);
          });

          var boundingRectangle = BoundingRectangle.from(outsideCoords);
          boundingRectangle.moveTo({x: 0, y: 0});
          var scale = boundingRectangle.computerBestScale({width: 100, height: 100});
          boundingRectangle.scale(scale);

          var outside = outsideCoords.map(function(coord) {
            return boundingRectangle.normalize(coord);
          });

          var inside = insideCoords.map(function(coord) {
            return boundingRectangle.normalize(coord);
          });

          document.getElementById("inside_coords").innerHTML = JSON.stringify(inside);
          document.getElementById("outside_coords").innerHTML = JSON.stringify(outside);
        })
      }
    </script>
  </head>
  <body onload="initialize()">
    <div id="map_canvas" style="width:50%; height:100%;"></div>
    <div id="outside_coords" style="width:50%; float: left; border-style: solid; border-width: 1px;">Hello2</div>
    <div id="inside_coords" style="width:49%; float: left; border-style: solid; border-width: 1px;">Hello</div>
  </body>
</html>